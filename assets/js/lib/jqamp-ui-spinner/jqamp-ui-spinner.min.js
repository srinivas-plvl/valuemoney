/*!
* jqAmp UI Spinner v1.0 (for jQuery/jQuery UI)
*
* Copyright 2012, Tony Kramer
* Dual licensed under the MIT or GPL Version 2 licenses.
* https://github.com/flamewave/jqamp-ui-spinner/raw/master/GPL-LICENSE.txt
* https://github.com/flamewave/jqamp-ui-spinner/raw/master/MIT-LICENSE.txt
*/

/*
* For documentation and for the latest version, see:
* https://github.com/flamewave/jqamp-ui-spinner
*
* Dependencies:
* - jQuery (1.7.1+)
* - jQuery-ui (1.8.18+ - core, widget, button)
* - jQuery MouseWheel (3.0.6+ - optional, for mousewheel support)
*/

(function(f){var h=["ui-icon-triangle-1-n","ui-icon-triangle-1-s"];f.widget("jqAmpUI.spinner",{version:"1.0",options:{disabled:!1,readonly:!1,keyboard:{allowed:null,upDownArrows:{defaultAction:"step",ctrlAction:"halfStep",shiftAction:"page"},pageUpDown:!0},mousewheel:{defaultAction:"step",ctrlAction:"halfStep",shiftAction:"page"},buttons:{position:"inside",up:{icon:h[0],title:null},down:{icon:h[1],title:null},defaultAction:"step",ctrlAction:"halfStep",shiftAction:"page"},incremental:!0,delay:500,
format:null,parse:null,compare:null,min:!1,max:!1,empty:!1,step:1,halfStep:0.5,page:10},uiSpinner:null,document:null,window:null,_timeout:null,_interval:null,_spinCount:0,_isSpinning:!1,_previous:void 0,_kbEvents:!1,_mwEvents:!1,_buttons:!1,_create:function(){var a=this.element,b,c=this.options,d=this;this.document=f(a.style?a.ownerDocument:a.document||a);this.window=this.document[0].defaultView||this.document[0].parentWindow;this._setValue(this._parse(a.val()),!1,!1);f.each(["min","max","step"],
function(b,f){var i=a.attr(f);void 0!==i&&(i.length&&!c[f])&&(c[f]=d._parse(i))});this.uiSpinner=b=a.addClass("ui-spinner-input ui-corner-all").attr({autocomplete:"off",role:"spinbutton","aria-valuemin":this._format(this._minVal()),"aria-valuemax":this._format(this._maxVal()),"aria-valuenow":this.value()}).wrap(this._uiSpinnerHtml()).bind({"focus.spinner":function(){b.addClass("ui-state-active");d._previous=d.value()},"blur.spinner":function(c){var f=d.value();b.removeClass("ui-state-active");a.attr("aria-valuenow",
f);0!==d._compare(d._previous,f)&&d._trigger("change",c);d._previous=void 0}}).parent();this.uiSpinner.bind({"mouseenter.spinner":function(){b.addClass("ui-state-hover")},"mouseleave.spinner":function(){b.removeClass("ui-state-hover")}});c.buttons&&this._setupButtons();c.keyboard&&this._setupKeyboard();c.mousewheel&&this._setupMouseWheel();(c.disabled||a._prop("disabled"))&&this._setOption("disabled",!0);(c.readonly||a._prop("readonly"))&&this._setOption("readonly",!0);f(this.window).bind("beforeunload.spinner",
function(){a.removeAttr("autocomplete")})},_uiSpinnerHtml:function(){return'<span class="ui-widget ui-spinner ui-spinner-nobuttons" />'},destroy:function(){f(this.window).unbind("beforeunload.spinner");this.element.siblings(".ui-spinner-button").remove();this.element.unbind(".spinner").unwrap().removeClass("ui-spinner-input").removeAttr("disabled autocomplete role aria-valuemin aria-valuemax aria-valuenow");f.Widget.prototype.destroy.call(this)},_setupButtons:function(){if(!this._buttons){var a=this.options.buttons,
b=this,c=!1,d=!0;if(a){if(a.position){if("insideStacked"===a.position||"outsideStacked"===a.position)c=!0;if("outside"===a.position||"outsideStacked"===a.position)d=!1}d?this.uiSpinner.addClass("ui-widget-content ui-corner-all ui-spinner-inside").children(".ui-spinner-input").removeClass("ui-corner-all"):this.uiSpinner.addClass("ui-spinner-outside").removeClass("ui-widget-content ui-corner-all").children(".ui-spinner-input").addClass("ui-corner-all");this.uiSpinner.removeClass("ui-spinner-nobuttons").addClass(c?
"ui-spinner-stacked":"ui-spinner-adjacent");var e=this.element[0],g=this.document;this.uiSpinner.append(this._buttonHtml(c,d)).children(".ui-spinner-button").attr("tabIndex",-1).button().removeClass("ui-corner-all").bind({"mousedown.spinner":function(c){c.preventDefault();g.activeElement!==e&&e.focus();!b.options.disabled&&!b.options.readonly&&b._start(c)&&b._spin(b._getAmount(a,c.ctrlKey,c.shiftKey),f(c.currentTarget).hasClass("ui-spinner-down"),!0,c)},"mouseup.spinner":function(a){b._stop(a)}});
a&&(a.up&&a.up.title)&&this.uiSpinner.children(".ui-spinner-up").attr("title",a.up.title);a&&(a.down&&a.down.title)&&this.uiSpinner.children(".ui-spinner-down").attr("title",a.down.title);this._buttons=!0}}},_removeButtons:function(){this._buttons&&(this.uiSpinner.removeClass("ui-spinner-inside ui-spinner-outside ui-spinner-stacked ui-spinner-adjacent ui-widget-content ui-corner-all").addClass("ui-spinner-nobuttons").children(".ui-spinner-input").addClass("ui-corner-all").end().children(".ui-spinner-button").remove(),
this._buttons=!1)},_buttonHtml:function(a,b){function c(a,b){return!d||!d[a]||!d[a].icon||"string"!==typeof d[a].icon?h[b]:d[a].icon}var d=this.options.buttons,e,f;a?(e=b?" ui-corner-tr":" ui-corner-top",f=b?"ui-corner-br":"ui-corner-bottom"):(e=b?"":" ui-corner-left",f="ui-corner-right");return'<a class="ui-spinner-button ui-spinner-up'+e+'"><span class="ui-icon '+c("up",0)+'">&#9650;</span></a><a class="ui-spinner-button ui-spinner-down '+f+'"><span class="ui-icon '+c("down",1)+'">&#9660;</span></a>'},
_setupKeyboard:function(){var a=this,b=this.options,c=b.keyboard,d=f.ui.keyCode;!this._kbEvents&&c&&(this.element.bind({"keydown.spinner":function(e){if(!b.disabled&&!b.readonly&&c){switch(e.which){case d.UP:if(!0===c||c.upDownArrows){a._start(e)&&a._spin(a._getAmount(c.upDownArrows,e.ctrlKey,e.shiftKey),!1,!1,e);e.preventDefault();return}break;case d.DOWN:if(!0===c||c.upDownArrows){a._start(e)&&a._spin(a._getAmount(c.upDownArrows,e.ctrlKey,e.shiftKey),!0,!1,e);e.preventDefault();return}break;case d.PAGE_UP:if(!0===
c||c.pageUpDown){a._start(e)&&a._spin(a._getPage(),!1,!1,e);e.preventDefault();return}break;case d.PAGE_DOWN:if(!0===c||c.pageUpDown){a._start(e)&&a._spin(a._getPage(),!0,!1,e);e.preventDefault();return}}if(!(!0===c||!c.allowed||a._isAllowedKey(e.which,e)))if(!f.isFunction(c.allowed)||!c.allowed.apply(a,[e.which,e]))f.isArray(c.allowed)&&0<=c.allowed.indexOf(e.which)||e.preventDefault()}},"keyup.spinner":function(b){a._stop(b)}}),this._kbEvents=!0)},_isAllowedKey:function(a){return f.isControlKey(a)},
_removeKeyboard:function(){this._kbEvents&&(this.element.unbind("keydown.spinner").unbind("keyup.spinner"),this._kbEvents=!1)},_setupMouseWheel:function(){var a=this,b=this.options.mousewheel;!this._mwEvents&&b&&(this.element.bind("mousewheel.spinner",function(c,d){d&&(!a.options.disabled&&!a.options.readonly)&&a._start(c)&&(c.preventDefault(),a._spin(a._getAmount(b,c.ctrlKey,c.shiftKey),0>d,!1,c),clearTimeout(a._timer),a._timer=setTimeout(function(){a._isSpinning&&a._stop(c)},100))}),this._mwEvents=
!0)},_removeMouseWheel:function(){this._mwEvents&&(this.element.unbind("mousewheel.spinner"),this._mwEvents=!1)},_getAmount:function(a,b,c){return!a||"object"!==typeof a?b?this._getHalfStep():c?this._getPage():this._getStep():b?a.ctrlAction?this._actionAmount(a.ctrlAction):this._getHalfStep():c?a.shiftAction?this._actionAmount(a.shiftAction):this._getPage():a.defaultAction?this._actionAmount(a.defaultAction):this._getStep()},_actionAmount:function(a){return"halfStep"===a?this._getHalfStep():"page"===
a?this._getPage():this._getStep()},_getStep:function(){return this.options.step||1},_getHalfStep:function(){return this.options.halfStep||this._getStep()},_getPage:function(){return this.options.page||this._getStep()},_parse:function(a){if(f.isFunction(this.options.parse))return this.options.parse.apply(this,[a]);try{return this._defaultParse(a)}catch(b){throw"SpinnerException: Unable to parse the value specified without a custom parser (parse option). Reason: "+b;}},_defaultParse:function(a){return"number"===
typeof a?a:parseFloat(a)||0},_format:function(a){if(void 0===a||null===a||!1===a)return"";if(f.isFunction(this.options.format))return this.options.format.apply(this,[a]);try{return this._defaultFormat(a)}catch(b){throw"SpinnerException: Unable to convert value to a string without a custom converter (format option). Reason: "+b;}},_defaultFormat:function(a){return a.toString()},_compare:function(a,b){if(f.isFunction(this.options.compare))return this.options.compare.apply(this,[a,b]);try{return this._defaultCompare(a,
b)}catch(c){throw"SpinnerExpcetion: Unable to compare the value type without a custom converter (compare option).";}},_defaultCompare:function(a,b){if(null===a||void 0===a)a=this._emptyVal()||0;if(null===b||void 0===b)b=this._emptyVal()||0;return a===b||a==b?0:a<b?-1:1},_isEmptyVal:function(a){var b=this._emptyVal();return!1===b?!1:0===this._compare(b,void 0===a?this.value():a)},_emptyVal:function(){var a=this.options.empty;return!1===a||void 0===a?!1:f.isFunction(a)?a.apply(this):this.options.empty=
a=this._parse(a)},_minVal:function(){var a=this.options.min;return!1===a||void 0===a?!1:f.isFunction(a)?a.apply(this):this.options.min=a=this._parse(a)},_maxVal:function(){var a=this.options.max;return!1===a||void 0===a?!1:f.isFunction(a)?a.apply(this):this.options.max=a=this._parse(a)},_checkMinMax:function(a,b){var c=this._minVal(),d=this._maxVal();return!1!==c&&0>this._compare(a,c)?0===this._compare(b,c)?!1:c:!1!==d&&0<this._compare(a,d)?0===this._compare(b,d)?!1:d:a},_setValue:function(a,b,c){if(!c&&
(a=this._checkMinMax(a,this.value()),!1===a))return;var c=this._isEmptyVal(a),d=this._format(a),b=b&&d!==this.element.val();this.element.val(c?"":d).attr("aria-valuenow",a);b&&this._trigger("change")},_adjustValue:function(a,b,c,d,e){if(this.options.disabled||!b)return!1;var g=this.value(),a=this._checkMinMax(f.isFunction(b)?b.call(this,[g,a,c]):this._defaultValueCalc(g,b,a,c),g);if(!1===a)return this._isSpinning&&this._stop(e),!1;if(this._isSpinning&&!1===this._trigger("spin",e,{value:a}))return!1;
this._setValue(a,d,!0);return!0},_defaultValueCalc:function(a,b,c,d){return d?a-b*c:a+b*c},_increment:function(a){var b=this.options.incremental;return b?f.isFunction(b)?b.apply(this,[a]):this._defaultIncrement(a):1},_defaultIncrement:function(a){return Math.floor(a*a*a/5E4-a*a/500+17*a/200+1)},_start:function(a){if(!this._isSpinning&&!1===this._trigger("start",a))return!1;this._spinCount||(this._spinCount=1);return this._isSpinning=!0},_spin:function(a,b,c,d){this._spinCount||(this._spinCount=1);
this._adjustValue(this._increment(this._spinCount),a,b,!1,d)?(this._spinCount++,c&&this._repeat(a,b,d)):this._stop(d)},_repeat:function(a,b,c){var d=this.options.delay;if("number"!==typeof d||0>=d)d=500;var e=this;this._timeout=setTimeout(function(){clearTimeout(e._timeout);e._timeout=null;e._spin(a,b,!1,c);e._interval=setInterval(function(){e._spin(a,b,!1,c)},40)},d)},_stop:function(a){clearTimeout(this._timeout);clearInterval(this._interval);this._interval=this._timeout=null;this._spinCount=0;this._isSpinning&&
(this._isSpinning=!1,this._trigger("stop",a))},_setOption:function(a,b){var c=this.options,d=this.element,e=this.uiSpinner;switch(a){case "disabled":c.disabled=b;d._prop("disabled",b).parent()[b?"addClass":"removeClass"]("ui-spinner-disabled ui-state-disabled").attr("aria-disabled",b);c.buttons&&e.children(".ui-spinner-button").button(b?"disable":"enable");break;case "readonly":c.readonly=b;d._prop("readonly",b).parent()[b?"addClass":"removeClass"]("ui-spinner-readonly");c.buttons&&e.children(".ui-spinner-button").button(b?
"disable":"enable");break;case "keyboard":c.keyboard=b;this._removeKeyboard();this._setupKeyboard();break;case "mousewheel":c.mousewheel=b;this._removeMouseWheel();this._setupMouseWheel();break;case "buttons":c.buttons=b;this._removeButtons();this._setupButtons();break;case "format":c.format=b;this._setValue(this.value(),!1,!0);break;case "min":c.min=b;c=this._minVal();!1!==c&&0>this._compare(this.value(),c)&&this._setValue(c,!0,!0);break;case "max":c.max=b;c=this._maxVal();!1!==c&&0<this._compare(this.value(),
c)&&this._setValue(c,!0,!0);break;case "empty":!1===b||void 0===b?(e=this._emptyVal(),c.empty=!1,!d.val()&&!1!==e&&this._setValue(e,!1,!0)):(c.empty=b,this._isEmptyVal(this.value())&&d.val(""));break;default:f.Widget.prototype._setOption.call(this,a,b)}return this},value:function(a){var b=this.options;if(void 0===a){if(a=this.element.val())return this._parse(a);void 0!==b.empty&&!1!==b.empty&&this._cloneValue(b.empty);return null}b.disabled||this._setValue(this._parse(a),!0,!1);return this},_cloneValue:function(a){return"object"!==
typeof a?a:a instanceof Date?new Date(a.getTime()):f.extend(!0,{},a)},stepUp:function(a){this._adjustValue(a||1,this._getStep(),!1,!0,null);return this},stepDown:function(a){this._adjustValue(a||1,this._getStep(),!0,!0,null);return this},halfStepUp:function(a){this._adjustValue(a||1,this._getHalfStep(),!1,!0,null);return this},halfStepDown:function(a){this._adjustValue(a||1,this._getHalfStep(),!0,!0,null);return this},pageUp:function(a){this._adjustValue(a||1,this._getPage(),!1,!0,null);return this},
pageDown:function(a){this._adjustValue(a||1,this._getPage(),!0,!0,null);return this},spinStart:function(a,b){this._isSpinning&&this._stop(null);if(this._start(null)){!0===a&&(b=!0,a=0);var c=this;this._spin(this._getStep(),b,!1,null);this._interval=setInterval(function(){c._spin(c._getStep(),b,!1,null)},40);a&&setTimeout(function(){c._stop(null)},a)}},spinStop:function(){this._stop(null)},select:function(){this.options.disabled||this.element.select();return this},readonly:function(){this._setOption("readonly",
!0);return this},editable:function(){this._setOption("readonly",!1);return this},widget:function(){return this.uiSpinner}});f.fn._prop=function(a,b){return this.prop?void 0===b?this.prop(a):this.prop(a,b):!1===b?this.removeAttr(a):void 0===b?this.attr(a):this.attr(a,!0===b?a:b)};f.isControlKey=function(a){return 47>=a&&32!=a||91<=a&&95>=a||112<=a&&-1===[186,187,188,189,190,191,192,219,220,221,222].indexOf(a)}})(jQuery);