/*!
 * iButton jQuery Plug-in
 *
 * Copyright 2011 Giva, Inc. (http://www.givainc.com/labs/) 
 * 
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 * 
 * 	http://www.apache.org/licenses/LICENSE-2.0
 * 
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * Date: 2011-07-26
 * Rev:  1.0.03
 */

(function(c){c.iButton={version:"1.0.03",setDefaults:function(m){c.extend(n,m)}};c.fn.iButton=function(m){var a="string"==typeof arguments[0]&&arguments[0],h=a&&Array.prototype.slice.call(arguments,1)||arguments,b=0==this.length?null:c.data(this[0],"iButton");if(b&&a&&this.length){if("object"==a.toLowerCase())return b;if(b[a]){var f;this.each(function(l){var d=c.data(this,"iButton")[a].apply(b,h);if(0==l&&d)if(d.jquery)f=c([]).add(d);else return f=d,!1;else d&&d.jquery&&(f=f.add(d))});return f||this}return this}return this.each(function(){new B(this,
m)})};var C=0;c.browser.iphone=-1<navigator.userAgent.toLowerCase().indexOf("iphone");var B=function(m,a){var h=this,b=c(m),f=++C,l=!1,d,v,k,w=!1,p=null,y=null,q=null,z=null,a=c.extend({},n,a,c.metadata?b.metadata():{});k=a.labelOn==D&&a.labelOff==E;if(b.is(":checkbox, :radio")){if(c.data(b[0],"iButton"))return}else return b.find(":checkbox, :radio").iButton(a);c.data(b[0],"iButton",h);"auto"==a.resizeHandle&&(a.resizeHandle=!k);"auto"==a.resizeContainer&&(a.resizeContainer=!k);this.toggle=function(a){b.attr("checked",
0<arguments.length?a:!b[0].checked).trigger("change")};this.disable=function(e){var d=0<arguments.length?e:!l;l=d;b.attr("disabled",d);g[d?"addClass":"removeClass"](a.classDisabled);c.isFunction(a.disable)&&a.disable.apply(h,[l,b,a])};this.repaint=function(){r()};this.destroy=function(){c([b[0],g[0]]).unbind(".iButton");c(document).unbind(".iButton_"+f);g.after(b).remove();c.data(b[0],"iButton",null);c.isFunction(a.destroy)&&a.destroy.apply(h,[b,a])};b.wrap('<div class="'+c.trim(a.classContainer+
" "+a.className)+'" />').after('<div class="'+a.classHandle+'"><span class="handle_bg"/></div><div class="'+a.classLabelOff+'"><span><label>'+a.labelOff+'</label></span></div><div class="'+a.classLabelOn+'"><span><label>'+a.labelOn+"</label></span></div>");var g=b.parent(),i=b.siblings("."+a.classHandle),A=b.siblings("."+a.classLabelOff),s=A.children("span"),t=b.siblings("."+a.classLabelOn),u=t.children("span");if(a.resizeHandle||a.resizeContainer)d=u.outerWidth(),v=s.outerWidth();a.resizeHandle?
(k=Math.min(d,v),i.css("width",k)):k=i.width();a.resizeContainer?(d=Math.max(d,v)+k+20,g.css("width",d),A.css("width",d-5)):d=g.width();var j=d-k-1,r=function(e){var c=b[0].checked?j:-1;(e=0<arguments.length?arguments[0]:!0)&&a.enableFx?(i.stop().animate({left:c},a.duration,a.easing),t.stop().animate({width:c+4},a.duration,a.easing),u.stop().animate({marginLeft:c-j},a.duration,a.easing),s.stop().animate({marginRight:-c},a.duration,a.easing)):(i.css("left",c),t.css("width",c+4),u.css("marginLeft",
c-j),s.css("marginRight",-c))};r(!1);var x=function(a){return a.pageX||(a.originalEvent.changedTouches?a.originalEvent.changedTouches[0].pageX:0)};g.bind("mousedown.iButton touchstart.iButton",function(e){if(!c(e.target).is(":checkbox, :radio")&&!(l||!a.allowRadioUncheck&&b.is(":radio:checked")))return e.preventDefault(),p=i,y=x(e),q=y-(parseInt(i.css("left"),10)||0),z=(new Date).getTime(),!1});a.enableDrag&&c(document).bind("mousemove.iButton_"+f+" touchmove.iButton_"+f,function(b){if(p==i)return b.preventDefault(),
b=x(b),b!=q&&(w=!0,g.addClass(a.classHandleActive)),b=Math.min(1,Math.max(0,(b-q)/j)),i.css("left",b*j),t.css("width",b*j+4),s.css("marginRight",-b*j),u.css("marginLeft",-(1-b)*j),!1});c(document).bind("mouseup.iButton_"+f+" touchend.iButton_"+f,function(e){if(p!=i)return!1;e.preventDefault();var d=!0;!w||(new Date).getTime()-z<a.clickOffset?(e=b[0].checked,b.attr("checked",!e),c.isFunction(a.click)&&a.click.apply(h,[!e,b,a])):(e=0.5<=(x(e)-q)/j,b[0].checked==e&&(d=!1),b.attr("checked",e));g.removeClass(a.classHandleActive);
w=p=null;d?b.trigger("change"):r();return!1});b.bind("change.iButton",function(){r();if(b.is(":radio")){var d=b[0];c(d.form?d.form[d.name]:":radio[name="+d.name+"]").filter(":not(:checked)").iButton("repaint")}c.isFunction(a.change)&&a.change.apply(h,[b,a])}).bind("focus.iButton",function(){g.addClass(a.classFocus)}).bind("blur.iButton",function(){g.removeClass(a.classFocus)});c.isFunction(a.click)&&b.bind("click.iButton",function(){a.click.apply(h,[b[0].checked,b,a])});b.is(":disabled")&&this.disable(!0);
c.browser.msie&&(g.find("*").andSelf().attr("unselectable","on"),b.bind("click.iButton",function(){b.triggerHandler("change.iButton")}));c.isFunction(a.init)&&a.init.apply(h,[b,a])},n={duration:200,easing:"swing",labelOn:"ON",labelOff:"OFF",resizeHandle:"auto",resizeContainer:"auto",enableDrag:!0,enableFx:!0,allowRadioUncheck:!1,clickOffset:120,className:"",classContainer:"ibutton-container",classDisabled:"ibutton-disabled",classFocus:"ibutton-focus",classLabelOn:"ibutton-label-on",classLabelOff:"ibutton-label-off",
classHandle:"ibutton-handle",classHandleMiddle:"ibutton-handle-middle",classHandleRight:"ibutton-handle-right",classHandleActive:"ibutton-active-handle",classPaddingLeft:"ibutton-padding-left",classPaddingRight:"ibutton-padding-right",init:null,change:null,click:null,disable:null,destroy:null},D=n.labelOn,E=n.labelOff})(jQuery);